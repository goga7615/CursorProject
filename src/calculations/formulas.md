# Формулы для расчетов в системе блюд

## 1. Расчет стоимости

### Стоимость ингредиента в рецепте
```
=Количество * Стоимость_за_единицу
=D2*VLOOKUP(C2,Ингредиенты!A:E,5,FALSE)
```

### Общая стоимость полуфабриката
```
=SUMIF(Рецепты!B:B,ID_полуфабриката,Рецепты!E:E)
=SUMIF(Рецепты!B:B,A2,Рецепты!E:E)
```

### Стоимость блюда
```
=SUMIF(Состав_блюд!B:B,ID_блюда,Состав_блюд!F:F)
=SUMIF(Состав_блюд!B:B,A2,Состав_блюд!F:F)
```

## 2. Расчет пищевой ценности

### Калории ингредиента в рецепте
```
=Количество * Калории_на_100г / 100
=D2*VLOOKUP(C2,Ингредиенты!A:I,6,FALSE)/100
```

### Белки ингредиента в рецепте
```
=Количество * Белки_на_100г / 100
=D2*VLOOKUP(C2,Ингредиенты!A:I,7,FALSE)/100
```

### Жиры ингредиента в рецепте
```
=Количество * Жиры_на_100г / 100
=D2*VLOOKUP(C2,Ингредиенты!A:I,8,FALSE)/100
```

### Углеводы ингредиента в рецепте
```
=Количество * Углеводы_на_100г / 100
=D2*VLOOKUP(C2,Ингредиенты!A:I,9,FALSE)/100
```

### Общая калорийность блюда
```
=SUMIF(Состав_блюд!B:B,ID_блюда,Состав_блюд!G:G)
=SUMIF(Состав_блюд!B:B,A2,Состав_блюд!G:G)
```

## 3. Расчеты с учетом потерь

### Выход с учетом потерь (10%)
```
=Исходное_количество * 0.9
=D2*0.9
```

### Стоимость с учетом потерь
```
=Стоимость_ингредиентов / Выход_с_потерями * 100
=SUMIF(Рецепты!B:B,A2,Рецепты!E:E) / (D2*0.9) * 100
```

## 4. Аналитические формулы

### Средняя стоимость блюда в категории
```
=AVERAGEIF(Блюда!C:C,Категория,Блюда!E:E)
=AVERAGEIF(Блюда!C:C,"Вторые блюда",Блюда!E:E)
```

### Количество блюд в категории
```
=COUNTIF(Блюда!C:C,Категория)
=COUNTIF(Блюда!C:C,"Салаты")
```

### Топ-5 самых дорогих блюд
```
=QUERY(Блюда!A:F,"SELECT B,E ORDER BY E DESC LIMIT 5")
```

### Поиск блюд по ингредиенту
```
=QUERY(Состав_блюд!A:G,"SELECT B WHERE D = "&ID_ингредиента)
```

## 5. Формулы для меню

### Стоимость меню из нескольких блюд
```
=SUM(Стоимость_блюда_1, Стоимость_блюда_2, ...)
=SUM(E2:E10)
```

### Общая калорийность меню
```
=SUM(Калории_блюда_1, Калории_блюда_2, ...)
=SUM(F2:F10)
```

### Процентное соотношение белков/жиров/углеводов
```
=Белки / (Белки + Жиры + Углеводы) * 100
=G2/(G2+H2+I2)*100
```

## 6. Формулы для планирования

### Расчет необходимого количества ингредиентов
```
=Количество_порций * Количество_ингредиента_на_порцию
=B2*D2
```

### Стоимость закупок
```
=SUM(Количество_ингредиента_1 * Стоимость_1, Количество_ингредиента_2 * Стоимость_2, ...)
=SUMPRODUCT(Количество_ингредиентов, Стоимости)
```

## 7. Специальные функции

### Проверка наличия аллергенов
```
=IF(COUNTIF(Ингредиенты_в_блюде,Аллерген)>0,"Содержит аллерген","Безопасно")
=IF(COUNTIF(Состав_блюд!D:D,Аллерген)>0,"⚠️","✅")
```

### Расчет скидки
```
=Стоимость * (1 - Процент_скидки)
=E2*(1-0.15)
```

### НДС
```
=Стоимость * 0.2
=E2*0.2
```

## 8. Примеры использования

### Полная формула для расчета стоимости блюда "Борщ"
```
=SUMIF(Состав_блюд!B:B,VLOOKUP("Борщ",Блюда!B:A,1,FALSE),Состав_блюд!F:F)
```

### Расчет калорийности с учетом веса порции
```
=Калории_на_100г * Вес_порции / 100
=F2*D2/100
```

### Поиск всех блюд, содержащих определенный ингредиент
```
=QUERY(Состав_блюд!A:G,"SELECT B WHERE D = "&VLOOKUP("Картофель",Ингредиенты!B:A,1,FALSE))
```
